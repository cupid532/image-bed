# 图床系统 - 部署检查清单

## 部署前准备

### 1. 服务器要求
- [ ] 操作系统: Debian 12 / Ubuntu 20.04+ / CentOS 8+
- [ ] 最小配置: 1 核 CPU, 1GB 内存, 20GB 硬盘
- [ ] 推荐配置: 2 核 CPU, 2GB 内存, 50GB+ 硬盘
- [ ] 网络: 公网 IP 地址

### 2. 域名配置
- [ ] 域名已注册: tc.bluse.me
- [ ] DNS 已解析到服务器 IP
- [ ] DNS 解析已生效（ping tc.bluse.me）

### 3. 端口开放
- [ ] 端口 80 (HTTP)
- [ ] 端口 443 (HTTPS)
- [ ] 端口 22 (SSH)

---

## 部署步骤

### 第一步: 上传项目文件
- [ ] 项目文件已上传到 `/root/image_bed/`
- [ ] 所有脚本有执行权限（deploy.sh, manage.sh, test_upload.sh）

### 第二步: 环境准备
- [ ] Docker 已安装
- [ ] Docker Compose 已安装
- [ ] Python3 已安装（用于生成密钥）

### 第三步: 配置文件
- [ ] `.env` 文件已创建
- [ ] `SECRET_KEY` 已修改为强密码
- [ ] `API_TOKEN` 已生成并保存
- [ ] `ALLOWED_HOSTS` 包含正确域名

### 第四步: 数据目录
- [ ] `/data` 目录已创建
- [ ] 目录权限正确 (755)
- [ ] 磁盘空间充足

### 第五步: Nginx 配置
- [ ] 首次部署使用 HTTP 配置
- [ ] `nginx/conf.d/default.conf` 已正确配置

### 第六步: 启动服务
- [ ] `docker compose up -d --build` 成功执行
- [ ] 所有容器正常运行 (`docker compose ps`)
- [ ] 数据库迁移完成
- [ ] 无错误日志

### 第七步: 功能测试
- [ ] Web 界面可访问
- [ ] 上传功能正常
- [ ] 图片可正常显示
- [ ] 图片库可访问
- [ ] API 接口正常

---

## SSL 证书配置

### 第一步: 获取证书
- [ ] Certbot 已安装
- [ ] 证书获取成功
- [ ] 证书文件已复制到项目目录

### 第二步: 配置 HTTPS
- [ ] Nginx HTTPS 配置已启用
- [ ] 服务已重启
- [ ] HTTPS 访问正常
- [ ] HTTP 自动跳转到 HTTPS

### 第三步: 自动续期
- [ ] 续期脚本已创建
- [ ] Crontab 定时任务已添加

---

## 安全检查

### 环境安全
- [ ] DEBUG 模式已关闭 (DEBUG=False)
- [ ] SECRET_KEY 足够复杂（50+ 字符）
- [ ] API_TOKEN 足够复杂（64 字符）
- [ ] 密码未在代码中硬编码
- [ ] `.env` 文件权限安全 (600)

### 网络安全
- [ ] HTTPS 已启用
- [ ] SSL 证书有效
- [ ] 防火墙规则已配置
- [ ] 不必要的端口已关闭

### 应用安全
- [ ] Token 认证已启用 (REQUIRE_AUTH=True)
- [ ] 文件类型验证启用
- [ ] 文件大小限制合理
- [ ] CSRF 保护启用

---

## 功能测试清单

### Web 界面测试
- [ ] 访问首页正常
- [ ] Token 输入框正常工作
- [ ] 点击上传功能正常
- [ ] 拖拽上传功能正常
- [ ] 粘贴上传功能正常（Ctrl+V）
- [ ] 多图上传功能正常
- [ ] 上传进度显示正常
- [ ] 链接复制功能正常
- [ ] 统计数据显示正常

### 图片库测试
- [ ] 图片库可访问
- [ ] 图片列表显示正常
- [ ] 分页功能正常
- [ ] 图片预览功能正常
- [ ] 删除功能正常
- [ ] 搜索功能正常（如有）

### API 测试
- [ ] 上传 API 正常 (`curl` 测试)
- [ ] 列表 API 正常
- [ ] 删除 API 正常
- [ ] Token 验证正常
- [ ] 错误处理正常

### 图片功能测试
- [ ] 图片压缩正常
- [ ] 图片去重正常
- [ ] 浏览量统计正常
- [ ] 图片访问速度快
- [ ] 缓存功能正常

---

## 管理后台检查

### 管理员账号
- [ ] 超级管理员账号已创建
- [ ] 可正常登录 `/admin/`
- [ ] 密码足够复杂

### 后台功能
- [ ] 可查看上传的图片
- [ ] 可管理 API Tokens
- [ ] 可查看统计信息
- [ ] 可删除图片

---

## 性能检查

### 服务器性能
- [ ] CPU 使用率正常 (<80%)
- [ ] 内存使用率正常 (<80%)
- [ ] 磁盘空间充足 (>20% 剩余)
- [ ] 网络连接正常

### 应用性能
- [ ] 页面加载速度快 (<2秒)
- [ ] 图片上传速度快
- [ ] 图片访问速度快
- [ ] Nginx 缓存工作正常

### Docker 性能
- [ ] 容器运行稳定
- [ ] 容器资源占用合理
- [ ] 日志大小可控

---

## 监控和维护

### 日志检查
- [ ] Web 应用日志正常
- [ ] Nginx 日志正常
- [ ] 无错误日志
- [ ] 日志轮转配置正常

### 备份计划
- [ ] 数据备份脚本已创建
- [ ] 定期备份计划已制定
- [ ] 备份恢复流程已测试

### 监控设置
- [ ] 服务状态监控
- [ ] 磁盘空间监控
- [ ] 访问日志监控
- [ ] 错误告警设置

---

## 文档检查

### 必备文档
- [ ] README.md 存在
- [ ] QUICKSTART.md 存在
- [ ] PROJECT_SUMMARY.md 存在
- [ ] 部署文档完整
- [ ] API 文档完整

### 配置文件
- [ ] .env.example 存在
- [ ] docker-compose.yml 正确
- [ ] Nginx 配置正确
- [ ] Django settings 正确

---

## 常用命令测试

### Docker 命令
- [ ] `docker compose ps` 正常
- [ ] `docker compose logs` 正常
- [ ] `docker compose restart` 正常

### 应用命令
- [ ] `./manage.sh` 脚本正常
- [ ] `./deploy.sh` 脚本正常
- [ ] `./test_upload.sh` 脚本正常

### 管理命令
- [ ] Token 生成命令正常
- [ ] 用户创建命令正常
- [ ] 数据库迁移命令正常

---

## 部署完成确认

### 最终检查
- [ ] 所有功能测试通过
- [ ] 安全配置完成
- [ ] SSL 证书配置完成
- [ ] 性能表现良好
- [ ] 文档齐全
- [ ] 备份计划就绪

### 交付物清单
- [ ] 项目源代码
- [ ] Docker 配置
- [ ] Nginx 配置
- [ ] 环境变量配置
- [ ] 部署脚本
- [ ] 管理脚本
- [ ] 完整文档
- [ ] API Token

---

## 故障排查清单

如遇问题，依次检查:

1. **容器状态**: `docker compose ps`
2. **应用日志**: `docker compose logs web`
3. **Nginx 日志**: `docker compose logs nginx`
4. **磁盘空间**: `df -h`
5. **网络连接**: `ping tc.bluse.me`
6. **端口占用**: `netstat -tlnp | grep :80`
7. **配置文件**: `.env` 和 `nginx/conf.d/default.conf`
8. **数据目录**: `ls -la /data`

---

## 联系信息

**项目位置**: `/root/image_bed/`
**数据目录**: `/data/`
**访问地址**: https://tc.bluse.me
**管理后台**: https://tc.bluse.me/admin/

---

## 备注

- 所有 ✓ 表示该项已完成
- 建议打印此清单，逐项完成
- 部署过程中遇到问题，参考 README.md
- 定期检查此清单，确保系统正常运行
